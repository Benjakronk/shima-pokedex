<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Shima Pok√©dex</title>
    <link rel="icon" type="image/x-icon" href="favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Chakra+Petch:wght@400;500;600;700&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loader">
            <div id="splashImage" class="splash-image"></div>
            <div class="loading-info">
                <p id="loadingText">Initializing Pok√©dex...</p>
                <div class="progress-container">
                    <div id="progressBar" class="progress-bar"></div>
                </div>
                <p id="loadingPercent">0%</p>
            </div>
        </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="toast"></div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h2>üîê Admin Access</h2>
                <button class="btn btn-ghost" onclick="closeAdminLogin()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter password">
                </div>
                <p id="loginError" class="error-text" style="display:none;">Incorrect password</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAdminLogin()">Cancel</button>
                <button class="btn btn-primary" onclick="attemptAdminLogin()">Login</button>
            </div>
        </div>
    </div>

    <!-- Pokemon Edit Modal (from card) -->
    <div id="pokemonEditModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>‚úèÔ∏è <span id="editModalPokemonName">Pok√©mon</span></h2>
                <button class="btn btn-ghost" onclick="closePokemonEditModal()">‚úï</button>
            </div>
            <div class="modal-body modal-scrollable">
                <div class="edit-section">
                    <div class="edit-section-header">
                        <h4>Types</h4>
                        <div class="edit-section-btns">
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('types', true)">Show</button>
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('types', false)">Hide</button>
                        </div>
                    </div>
                    <div class="edit-grid">
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_primaryType" onchange="updateCardEditField('primaryType')"><span>Primary Type</span></label>
                        <label class="edit-toggle" id="cardEdit_secondaryType_row"><input type="checkbox" id="cardEdit_secondaryType" onchange="updateCardEditField('secondaryType')"><span>Secondary Type</span></label>
                    </div>
                </div>
                <div class="edit-section">
                    <div class="edit-section-header">
                        <h4>Description</h4>
                        <div class="edit-section-btns">
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('description', true)">Show</button>
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('description', false)">Hide</button>
                        </div>
                    </div>
                    <div class="edit-grid">
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_description" onchange="updateCardEditField('description')"><span>Classification & Flavor Text</span></label>
                    </div>
                </div>
                <div class="edit-section">
                    <div class="edit-section-header">
                        <h4>Characteristics</h4>
                        <div class="edit-section-btns">
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('characteristics', true)">Show</button>
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('characteristics', false)">Hide</button>
                        </div>
                    </div>
                    <div class="edit-grid">
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_charSize" onchange="updateCardEditField('charSize')"><span>Size</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_charRarity" onchange="updateCardEditField('charRarity')"><span>Rarity</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_charBehavior" onchange="updateCardEditField('charBehavior')"><span>Behavior</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_charHabitat" onchange="updateCardEditField('charHabitat')"><span>Habitat</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_charActivity" onchange="updateCardEditField('charActivity')"><span>Activity</span></label>
                    </div>
                </div>
                <div class="edit-section">
                    <div class="edit-section-header">
                        <h4>Combat Stats</h4>
                        <div class="edit-section-btns">
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('combatStats', true)">Show</button>
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('combatStats', false)">Hide</button>
                        </div>
                    </div>
                    <div class="edit-grid">
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_statAC" onchange="updateCardEditField('statAC')"><span>AC</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_statHD" onchange="updateCardEditField('statHD')"><span>Hit Dice</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_statVD" onchange="updateCardEditField('statVD')"><span>Vitality Dice</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_statSpeed" onchange="updateCardEditField('statSpeed')"><span>Speed</span></label>
                    </div>
                </div>
                <div class="edit-section">
                    <div class="edit-section-header">
                        <h4>Ability Scores</h4>
                        <div class="edit-section-btns">
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('abilityScores', true)">Show</button>
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('abilityScores', false)">Hide</button>
                        </div>
                    </div>
                    <div class="edit-grid">
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_statSTR" onchange="updateCardEditField('statSTR')"><span>STR</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_statDEX" onchange="updateCardEditField('statDEX')"><span>DEX</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_statCON" onchange="updateCardEditField('statCON')"><span>CON</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_statINT" onchange="updateCardEditField('statINT')"><span>INT</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_statWIS" onchange="updateCardEditField('statWIS')"><span>WIS</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_statCHA" onchange="updateCardEditField('statCHA')"><span>CHA</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_statSaves" onchange="updateCardEditField('statSaves')"><span>Saves</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_statSkills" onchange="updateCardEditField('statSkills')"><span>Skills</span></label>
                    </div>
                </div>
                <div class="edit-section">
                    <div class="edit-section-header">
                        <h4>Abilities</h4>
                        <div class="edit-section-btns">
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('abilities', true)">Show</button>
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('abilities', false)">Hide</button>
                        </div>
                    </div>
                    <div class="edit-grid">
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_primaryAbility" onchange="updateCardEditField('primaryAbility')"><span>Primary Ability</span></label>
                        <label class="edit-toggle" id="cardEdit_secondaryAbility_row"><input type="checkbox" id="cardEdit_secondaryAbility" onchange="updateCardEditField('secondaryAbility')"><span>Secondary Ability</span></label>
                        <label class="edit-toggle" id="cardEdit_hiddenAbility_row"><input type="checkbox" id="cardEdit_hiddenAbility" onchange="updateCardEditField('hiddenAbility')"><span>Hidden Ability</span></label>
                    </div>
                </div>
                <div class="edit-section">
                    <div class="edit-section-header">
                        <h4>Senses</h4>
                        <div class="edit-section-btns">
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('senses', true)">Show</button>
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('senses', false)">Hide</button>
                        </div>
                    </div>
                    <div class="edit-grid">
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_senseDarkvision" onchange="updateCardEditField('senseDarkvision')"><span>Darkvision</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_senseBlindsight" onchange="updateCardEditField('senseBlindsight')"><span>Blindsight</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_senseTremorsense" onchange="updateCardEditField('senseTremorsense')"><span>Tremorsense</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_senseTrillsense" onchange="updateCardEditField('senseTrillsense')"><span>Trillsense</span></label>
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_senseMindsense" onchange="updateCardEditField('senseMindsense')"><span>Mindsense</span></label>
                    </div>
                </div>
                <div class="edit-section" id="cardEdit_evolution_section">
                    <div class="edit-section-header">
                        <h4>Evolution</h4>
                        <div class="edit-section-btns">
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('evolution', true)">Show</button>
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('evolution', false)">Hide</button>
                        </div>
                    </div>
                    <div class="edit-grid" id="cardEdit_evolution_grid">
                        <!-- Populated dynamically -->
                    </div>
                </div>
                <div class="edit-section">
                    <div class="edit-section-header">
                        <h4>Moves</h4>
                        <div class="edit-section-btns">
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('moves', true)">Show</button>
                            <button class="btn btn-tiny" onclick="setCategoryVisibility('moves', false)">Hide</button>
                        </div>
                    </div>
                    <div class="edit-grid">
                        <label class="edit-toggle"><input type="checkbox" id="cardEdit_moves" onchange="updateCardEditField('moves')"><span>Show Moves</span></label>
                        <div class="edit-level">
                            <label>Up to Level:</label>
                            <input type="number" id="cardEdit_movesMaxLevel" min="1" max="20" value="1" onchange="updateCardEditField('movesMaxLevel')">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="cardEditShowAll()">Show All</button>
                <button class="btn btn-secondary" onclick="cardEditHideAll()">Hide All</button>
                <button class="btn btn-primary" onclick="closePokemonEditModal()">Done</button>
            </div>
        </div>
    </div>

    <!-- Move Edit Modal -->
    <div id="moveEditModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>üìã Moves: <span id="moveEditPokemonName">Pok√©mon</span></h2>
                <button class="btn btn-ghost" onclick="closeMoveEditModal()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="move-edit-controls">
                    <label>Show moves up to level:</label>
                    <input type="number" id="moveEditLevel" min="1" max="20" value="1">
                </div>
                <p class="help-text">Checked moves are visible. Greyed moves are auto-shown by level threshold.</p>
                <div id="moveEditList" class="move-edit-list"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="closeMoveEditModal()">Done</button>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminModal" class="admin-modal">
        <div class="admin-modal-content">
            <div class="admin-header">
                <h2>üîß Admin Panel</h2>
                <div class="admin-header-actions">
                    <button class="btn btn-secondary" onclick="exportConfig()">üì§ Export</button>
                    <button class="btn btn-secondary" onclick="importConfig()">üì• Import</button>
                    <button class="btn btn-danger" onclick="logoutAdmin()">Logout</button>
                    <button class="btn btn-ghost" onclick="closeAdminPanel()">‚úï</button>
                </div>
                <input type="file" id="configFileInput" accept=".json" style="display:none" onchange="handleConfigImport(event)">
            </div>
            
            <!-- Admin Tabs -->
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="pokemon">üìã Pok√©mon</button>
                <button class="admin-tab" data-tab="defaults">‚öôÔ∏è Defaults</button>
                <button class="admin-tab" data-tab="searchMoves">üîç Move Search</button>
            </div>
            
            <!-- Pokemon Tab -->
            <div id="pokemonTab" class="admin-tab-content active">
                <div class="admin-toolbar">
                    <input type="text" id="adminPokemonSearch" placeholder="Search Pok√©mon...">
                    <div class="admin-bulk-actions">
                        <button class="btn btn-small btn-secondary" onclick="selectAllVisible()">Select All</button>
                        <button class="btn btn-small btn-success" onclick="registerSelected()">Register</button>
                        <button class="btn btn-small btn-danger" onclick="unregisterSelected()">Unregister</button>
                    </div>
                </div>
                
                <div class="admin-stats">
                    <span><strong id="registeredCount">0</strong> Registered</span>
                    <span><strong id="unregisteredCount">0</strong> Unregistered</span>
                </div>
                
                <div id="adminPokemonList" class="admin-pokemon-list"></div>
            </div>
            
            <!-- Defaults Tab -->
            <div id="defaultsTab" class="admin-tab-content">
                <div class="defaults-content defaults-scrollable">
                    <p class="tab-description">These settings apply when registering new Pok√©mon</p>
                    
                    <div class="defaults-section">
                        <h4>Types</h4>
                        <div class="defaults-grid">
                            <label class="default-toggle"><input type="checkbox" id="default_primaryType" onchange="updateDefault('primaryType')"><span>Primary Type</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_secondaryType" onchange="updateDefault('secondaryType')"><span>Secondary Type</span></label>
                        </div>
                    </div>
                    
                    <div class="defaults-section">
                        <h4>Description</h4>
                        <div class="defaults-grid">
                            <label class="default-toggle"><input type="checkbox" id="default_description" onchange="updateDefault('description')"><span>Classification & Flavor</span></label>
                        </div>
                    </div>
                    
                    <div class="defaults-section">
                        <h4>Characteristics</h4>
                        <div class="defaults-grid">
                            <label class="default-toggle"><input type="checkbox" id="default_charSize" onchange="updateDefault('charSize')"><span>Size</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_charRarity" onchange="updateDefault('charRarity')"><span>Rarity</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_charBehavior" onchange="updateDefault('charBehavior')"><span>Behavior</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_charHabitat" onchange="updateDefault('charHabitat')"><span>Habitat</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_charActivity" onchange="updateDefault('charActivity')"><span>Activity</span></label>
                        </div>
                    </div>
                    
                    <div class="defaults-section">
                        <h4>Combat Stats</h4>
                        <div class="defaults-grid">
                            <label class="default-toggle"><input type="checkbox" id="default_statAC" onchange="updateDefault('statAC')"><span>AC</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_statHD" onchange="updateDefault('statHD')"><span>Hit Dice</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_statVD" onchange="updateDefault('statVD')"><span>Vitality</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_statSpeed" onchange="updateDefault('statSpeed')"><span>Speed</span></label>
                        </div>
                    </div>
                    
                    <div class="defaults-section">
                        <h4>Ability Scores</h4>
                        <div class="defaults-grid">
                            <label class="default-toggle"><input type="checkbox" id="default_statSTR" onchange="updateDefault('statSTR')"><span>STR</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_statDEX" onchange="updateDefault('statDEX')"><span>DEX</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_statCON" onchange="updateDefault('statCON')"><span>CON</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_statINT" onchange="updateDefault('statINT')"><span>INT</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_statWIS" onchange="updateDefault('statWIS')"><span>WIS</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_statCHA" onchange="updateDefault('statCHA')"><span>CHA</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_statSaves" onchange="updateDefault('statSaves')"><span>Saves</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_statSkills" onchange="updateDefault('statSkills')"><span>Skills</span></label>
                        </div>
                    </div>
                    
                    <div class="defaults-section">
                        <h4>Abilities</h4>
                        <div class="defaults-grid">
                            <label class="default-toggle"><input type="checkbox" id="default_primaryAbility" onchange="updateDefault('primaryAbility')"><span>Primary Ability</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_secondaryAbility" onchange="updateDefault('secondaryAbility')"><span>Secondary Ability</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_hiddenAbility" onchange="updateDefault('hiddenAbility')"><span>Hidden Ability</span></label>
                        </div>
                    </div>
                    
                    <div class="defaults-section">
                        <h4>Senses</h4>
                        <div class="defaults-grid">
                            <label class="default-toggle"><input type="checkbox" id="default_senseDarkvision" onchange="updateDefault('senseDarkvision')"><span>Darkvision</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_senseBlindsight" onchange="updateDefault('senseBlindsight')"><span>Blindsight</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_senseTremorsense" onchange="updateDefault('senseTremorsense')"><span>Tremorsense</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_senseTrillsense" onchange="updateDefault('senseTrillsense')"><span>Trillsense</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_senseMindsense" onchange="updateDefault('senseMindsense')"><span>Mindsense</span></label>
                        </div>
                    </div>
                    
                    <div class="defaults-section">
                        <h4>Evolution</h4>
                        <div class="defaults-grid">
                            <label class="default-toggle"><input type="checkbox" id="default_evoFrom" onchange="updateDefault('evoFrom')"><span>Evolves From</span></label>
                            <label class="default-toggle"><input type="checkbox" id="default_evoTo" onchange="updateDefault('evoTo')"><span>Evolves To (all targets)</span></label>
                        </div>
                    </div>
                    
                    <div class="defaults-section">
                        <h4>Moves</h4>
                        <div class="defaults-grid">
                            <label class="default-toggle"><input type="checkbox" id="default_moves" onchange="updateDefault('moves')"><span>Show Moves</span></label>
                            <div class="default-level-input">
                                <label>Up to Level:</label>
                                <input type="number" id="default_movesMaxLevel" min="1" max="20" value="1" onchange="updateDefault('movesMaxLevel')">
                            </div>
                        </div>
                    </div>
                    
                    <div class="defaults-section">
                        <h4>App Settings</h4>
                        <div class="defaults-grid">
                            <div class="default-level-input">
                                <label>Splash Images:</label>
                                <input type="number" id="splashCountInput" min="1" max="99" value="9">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Searchable Moves Tab -->
            <div id="searchMovesTab" class="admin-tab-content">
                <div class="searchable-moves-content">
                    <p class="tab-description">Control which moves players can search for. Moves on registered Pok√©mon (up to their level) are automatically searchable.</p>
                    
                    <div class="searchable-moves-toolbar">
                        <input type="text" id="searchableMoveSearch" placeholder="Filter moves...">
                        <span class="move-count"><strong id="searchableMoveCount">0</strong> searchable</span>
                    </div>
                    
                    <div id="searchableMoveslist" class="searchable-moves-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="app">
        <header class="app-header">
            <div class="header-content">
                <h1 class="app-title">Shima Pok√©dex</h1>
                <button id="adminToggle" class="btn btn-icon" onclick="toggleAdminMode()" title="Admin">‚öôÔ∏è</button>
            </div>
            <nav class="nav-tabs">
                <button id="pokedexTab" class="nav-tab active" onclick="showView('pokedex')">üìñ Pok√©dex</button>
                <button id="movesTab" class="nav-tab" onclick="showView('moves')">‚öîÔ∏è Moves</button>
            </nav>
        </header>

        <main class="main-content">
            <!-- Pok√©dex View -->
            <div id="pokedexView" class="view active">
                <div class="search-section">
                    <input type="text" id="searchInput" placeholder="Search by name, type, or #...">
                    <button id="searchButton" class="btn btn-primary">Search</button>
                </div>
                
                <div class="filters-section">
                    <select id="typeFilter"><option value="">Type</option></select>
                    <select id="sizeFilter"><option value="">Size</option></select>
                    <select id="rarityFilter"><option value="">Rarity</option></select>
                    <select id="behaviorFilter"><option value="">Behavior</option></select>
                    <select id="habitatFilter"><option value="">Habitat</option></select>
                    <select id="activityFilter"><option value="">Activity</option></select>
                </div>
                
                <div id="pokemonResults" class="results-container">
                    <p class="placeholder-text">Search or use filters to find Pok√©mon</p>
                </div>
            </div>

            <!-- Moves View -->
            <div id="movesView" class="view">
                <div class="search-section">
                    <input type="text" id="moveSearchInput" placeholder="Search move or Pok√©mon name...">
                    <div class="level-input">
                        <label>Lv</label>
                        <input type="number" id="pokemonLevelInput" min="1" max="20" value="20">
                    </div>
                    <button id="moveSearchButton" class="btn btn-primary">Search</button>
                </div>
                
                <div id="moveResults" class="results-container">
                    <p class="placeholder-text">Search for moves or enter a Pok√©mon name</p>
                </div>
            </div>
        </main>

        <footer class="app-footer">
            <span>Cached: <span id="lastCacheTime">Never</span></span>
            <button class="btn btn-ghost btn-small" onclick="clearCacheAndReload()">üîÑ Refresh</button>
        </footer>
    </div>

    <script src="script.js"></script>
</body>
</html>
